include:
  - template: Auto-DevOps.gitlab-ci.yml


mac-x86_64:
  needs: ["docker-build"]
  only:
    - master
  script:
     - docker build --pull --build-arg RELEASE_TYPE=release-static-mac-x86_64 --cache-from $CI_REGISTRY_IMAGE:release-mac-x86_64 .
     - docker push ${CI_REGISTRY_IMAGE}mac/x86_64
  artifacts:
    name: mac-x86_64
    paths:
      - /home/leathean/bin


#linux-x86_64:
#  needs: ["docker-build"]
#  after_script:
#    - docker stop release-linux-x86_64
#  script:
#    - docker pull $CI_REGISTRY_IMAGE:release-linux-x86_64 || true
#    - docker build --build-arg RELEASE_TYPE=release-static-linux-x86_64 --cache-from $CI_REGISTRY_IMAGE:release-linux-x86_64 --tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA --tag $CI_REGISTRY_IMAGE:release-linux-x86_64 .
#    - docker push $CI_REGISTRY_IMAGE:release-linux-x86_64
#    - docker run --name=release-linux-x86_64 -d $CI_REGISTRY_IMAGE:release-linux-x86_64
#    - docker cp release-linux-x86_64:/home/leathean/bin $CI_PROJECT_DIR/artifacts
#  only:
#    - master
#  artifacts:
#    name: linux-x86_64
#    paths:
#      - artifacts


freebsd-x86_64:
  stage: build
  before_script:
    - export RELEASE_TYPE release-static-freebsd-x86_64
  needs: docker-build
  only:
    - master
  artifacts:
    name: freebsd-x86_64
    paths:
      - artifacts

win64:
  stage: build
  tags:
    - shared-windows
    - windows
    - windows-1809
  before_script:
    - export RELEASE_TYPE release-static-win64
  needs: docker-build
  only:
    - master
  artifacts:
    name: win64
    paths:
      - artifacts

